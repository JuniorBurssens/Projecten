'This VBA script calculates yearly growth in percent for any number of non contiguous ranges in a worksheet (requires same number of columns though)
Sub YYaangroei()

'The sub opens the datafile and initiates the userform (code below)

Dim AnnulOfOK As Long
Dim Werkbestandpad As String
Dim WerkbNaam As String
Dim Werkbestanden As Workbook

Opendoen:

MsgBox "Selecteer het bestand met gegevens" 'So users know to select the file
Application.FileDialog(msoFileDialogOpen).InitialFileName = ActiveWorkbook.Path 'Open the file dialog in the same path of the macro
Application.FileDialog(msoFileDialogOpen).AllowMultiSelect = False 'Only 1 file can be selected or you won't know what's what
AnnulOfOK = Application.FileDialog(msoFileDialogOpen).Show 'Returns 0 when cancelled 1 when selected

If AnnulOfOK <> 0 Then 'check for cancelling
    Werkbestandpad = Application.FileDialog(msoFileDialogOpen).SelectedItems(1) 'set path to file
    If Not IsWorkBookOpen(Werkbestandpad) Then
        Set Werkbestanden = Workbooks.Open(Werkbestandpad) 'open file
    Else
        WerkbNaam = Dir(Werkbestandpad)
        Set Werkbestanden = Workbooks(WerkbNaam)
    End If
Else
    If MsgBox("Wil je stoppen?", vbYesNo) = vbYes Then 'Give the user the option to stop executing the macro
        Exit Sub
    Else
        GoTo Opendoen 'return to file selection
    End If
End If

Werkbestanden.Activate

BereikenPerc.Show
End Sub
''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
Private Sub Annuleer1_Click()

Unload BereikenPerc

End Sub
''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
Private Sub OK1_Click()

Dim RekenRange As Range
Dim ColRij As New Collection
Dim BijRange() As String
Dim Ar As Long
Dim Rijen As Long
Dim Kolommen As Long
Dim Rekendata() As Double
Dim Rij As Long
Dim r As Long
Dim c As Long
Dim Blad As Worksheet
Dim Werkmap As Workbook
Dim Aangroei() As Double
Dim Arrayplak As Range
Dim Hoofding As Range
Dim PlakCol As Long
Dim i As Long

'On Error GoTo BadRange

'Variabelen instellen
If BereikenPerc.RefEdit1.Text <> "" Then
    BijRange = Split(BereikenPerc.RefEdit1.Text, ";")
    Set Blad = Worksheets(Range(BijRange(0)).Parent.Name)
    Set Werkmap = Workbooks(Blad.Parent.Name)
    Werkmap.Activate
    Blad.Activate
    For Ar = 0 To UBound(BijRange)
        Rijen = Rijen + Range(BijRange(Ar)).Rows.Count
    Next Ar
End If

Set Hoofding = Range(Cells(1, Range(BijRange(0)).Columns(1).Column), Cells(1, Range(BijRange(0)).Columns(Range(BijRange(0)).Columns.Count).Column))
Kolommen = Range(BijRange(0)).Columns.Count
ReDim Rekendata(1 To Rijen, 1 To Kolommen)
ReDim Aangroei(LBound(Rekendata, 1) To UBound(Rekendata, 1), LBound(Rekendata, 2) To UBound(Rekendata, 2))

'Array vullen
r = 1
For Ar = 0 To UBound(BijRange)
    If Range(BijRange(Ar)).Columns.Count = Kolommen Then
        For Rij = 1 To Range(BijRange(Ar)).Rows.Count
        ColRij.Add Cells(Range(BijRange(Ar)).Rows(Rij).Row, 1).Value
            For c = 1 To UBound(Rekendata, 2)
                Rekendata(r, c) = Range(BijRange(Ar)).Cells(Rij, c).Value
            Next c
            r = r + 1
        Next Rij
    End If
Next Ar

'Jaarlijkse aangroei
For r = 1 To UBound(Rekendata, 1)
    For c = 2 To UBound(Rekendata, 2)
        If Rekendata(r, c - 1) > 0 Then 'niet delen door 0
            Aangroei(r, c) = (Rekendata(r, c) - Rekendata(r, c - 1)) * 100 / Rekendata(r, c - 1)
        End If
    Next c
Next r

'Waarden plakken
Workbooks.Add
For i = 1 To ColRij.Count
    ActiveSheet.Cells(i + 1, 1).Value = ColRij(i)
Next i
PlakCol = 1 + 1
For c = 1 To UBound(Rekendata, 2)
    ActiveSheet.Range(Cells(1, PlakCol).Address) = "YY " & Hoofding(1, c).Value
    ActiveSheet.Range(Cells(1, PlakCol + 1).Address) = Hoofding(1, c).Value
    For r = 1 To UBound(Rekendata, 1)
        ActiveSheet.Range(Cells(r + 1, PlakCol).Address) = Aangroei(r, c)
        ActiveSheet.Range(Cells(r + 1, PlakCol + 1).Address) = Rekendata(r, c)
    Next r
    PlakCol = PlakCol + 2
Next c

Unload BereikenPerc
Exit Sub

BadRange:
    MsgBox "Ongeldig bereik gekozen. Kijk na of het gekozen bereik correct is."

End Sub
